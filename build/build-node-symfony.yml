build:node:
  extends: .base-build
  image:
    name: node:${BUILD_NODE_VERSION}
    pull_policy: if-not-present
  cache:
    key: assets-$CI_JOB_NAME
    paths:
      - ${PATH_PROJECT_DIR}/public/build
      - ${PATH_PROJECT_DIR}/public/bundles
  artifacts:
    paths:
      - ${PATH_PROJECT_DIR}/packages/xima-sitepackage/Resources/Public
      - ${PATH_PROJECT_DIR}/packages/xima-api-client/Resources/Public/Css/dist
      - ${PATH_PROJECT_DIR}/packages/xima-api-client/Resources/Public/JavaScript/dist
  script:
    - npm ci --prefix ${PATH_PROJECT_DIR} --cache ${PATH_PROJECT_DIR}/.npm-cache --prefer-offline
    - FEATURE_BRANCH_PATH_PUBLIC=/$CI_COMMIT_REF_NAME npm run build --prefix ${PATH_PROJECT_DIR}