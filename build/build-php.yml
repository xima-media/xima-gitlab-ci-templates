# Purpose:
#   Install composer dependencies
#
# Configuration:
#   Adjust the needed artifact paths
#
build:php:
  extends: .base-build
  image:
    name: composer:${BUILD_COMPOSER_VERSION}
    pull_policy: if-not-present
  variables:
    COMPOSER_CACHE_DIR: '${CI_PROJECT_DIR}/.composer'
  cache:
    key: composer-$CI_JOB_NAME-$CI_COMMIT_REF_NAME
    paths:
      - ${CI_PROJECT_DIR}/.composer
      - ${PATH_PROJECT_DIR}/vendor/
  artifacts:
    paths:
      - ${PATH_PROJECT_DIR}/vendor/
      - ${PATH_PROJECT_DIR}/var/cache/
  before_script:
    - composer config -g cache-dir "${CI_PROJECT_DIR}/.composer"
  script:
    - composer install --ignore-platform-reqs --optimize-autoloader --no-ansi --no-interaction --no-progress --no-scripts -d ${PATH_PROJECT_DIR}
