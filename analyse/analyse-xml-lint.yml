# Purpose:
#   Analyse job for checking all xml files
#
# Dependency:
#   Composer script "xml:lint"
#
analyse:xml:lint:
  needs: [ "build:php" ]
  extends: .base-analyse
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "pipeline"'
      when: never
    - if: '$CI_COMMIT_TAG && $CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+$/'
      when: never
    - if: '$CI_COMMIT_REF_NAME =~ $FEATURE_BRANCHES_REGEX'
      changes:
        - "**/*.xlf"
  script:
    - apt-get update -qq && apt-get install libxml2-utils -qq
    - composer run xml:lint -d ${PATH_APP_DIR}
